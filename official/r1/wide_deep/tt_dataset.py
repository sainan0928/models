from __future__ import absolute_import
from __future__ import division
from __future__ import print_function

import os
import sys
import feather

# pylint: disable=wrong-import-order
from absl import app as absl_app
from absl import flags
from six.moves import urllib
from six.moves import zip
import pandas as pd
import tensorflow as tf
# pylint: enable=wrong-import-order

from official.utils.flags import core as flags_core




DATA_URL = 'https://archive.ics.uci.edu/ml/machine-learning-databases/adult'
TRAINING_FILE = 'df_train_sampled.csv'
TRAINING_URL = '%s/%s' % (DATA_URL, TRAINING_FILE)
EVAL_FILE = 'df_test.csv'
EVAL_URL = '%s/%s' % (DATA_URL, EVAL_FILE)

# data_dir = 'C:\\tmp\\a6_nowait_data'
# os.path.join(data_dir, TRAINING_FILE)
# os.path.join(data_dir, EVAL_FILE)


_CSV_COLUMNS = [
    'speed', 'ais_rem_time', 'inv_speed', 'haversine_distance', 'coastal_rem_time',
    'dest_lat', 'dest_lon', 'dest_country_code', 'sch_scac',
    'y_actual'
]

_CSV_COLUMN_DEFAULTS = [[0.0], [0.0], [0.0], [0.0], [0.0],
                        [''], [''], [''], [''],
                        [0.0]]

_HASH_BUCKET_SIZE = 1000

_NUM_EXAMPLES = {
    'train': 1921018,
    'validation': 10637881,
}


def _download_and_clean_file(filename, url):
  """Downloads data from url, and makes changes to match the CSV format."""
  temp_file, _ = urllib.request.urlretrieve(url)
  with tf.compat.v1.gfile.Open(temp_file, 'r') as temp_eval_file:
    with tf.compat.v1.gfile.Open(filename, 'w') as eval_file:
      for line in temp_eval_file:
        line = line.strip()
        line = line.replace(', ', ',')
        if not line or ',' not in line:
          continue
        if line[-1] == '.':
          line = line[:-1]
        line += '\n'
        eval_file.write(line)
  tf.io.gfile.remove(temp_file)


def download(data_dir):
  """Download census data if it is not already present."""
  tf.io.gfile.makedirs(data_dir)

  training_file_path = os.path.join(data_dir, TRAINING_FILE)
  if not tf.io.gfile.exists(training_file_path):
    _download_and_clean_file(training_file_path, TRAINING_URL)

  eval_file_path = os.path.join(data_dir, EVAL_FILE)
  if not tf.io.gfile.exists(eval_file_path):
    _download_and_clean_file(eval_file_path, EVAL_URL)


def build_model_columns():
  """
  :param data = df_preprocess_noNA
  Builds a set of wide and deep feature columns.
  """
  # Continuous variable columns
  speed = tf.feature_column.numeric_column('speed')
  inv_speed = tf.feature_column.numeric_column('inv_speed')
  ais_rem_time = tf.feature_column.numeric_column('ais_rem_time')
  haversine_distance = tf.feature_column.numeric_column('haversine_distance')
  coastal_rem_time = tf.feature_column.numeric_column('coastal_rem_time')
  # dest_lat = tf.feature_column.numeric_column('dest_lat')
  # dest_lon = tf.feature_column.numeric_column('dest_lon')

  # categorical_column_with_vocabulary_list: OHE, use for low cardinality catg fts
  # use embeddings for high cardinality (i.e. > thousands unique levels) catg fts
  # when cardinality is very high, it becomes infeasible to train a neural network using OHE
  # embedding: low dim dense vector, need to tune embedding size
  # sch_scac = tf.feature_column.categorical_column_with_vocabulary_list(
  #     'sch_scac', sch_scac_levels_ls)
  dest_country_code = tf.feature_column.categorical_column_with_vocabulary_list(
      'dest_country_code', ['PF',
                             'TO',
                             'CK',
                             'NZ',
                             'KR',
                             'US',
                             'WS',
                             'AU',
                             'NO',
                             'DE',
                             'NL',
                             'GB',
                             'AE',
                             'QA',
                             'IN',
                             'IR',
                             'KW',
                             'PK',
                             'SG',
                             'TH',
                             'MY',
                             'MG',
                             'PH',
                             'HK',
                             'CN',
                             'TW',
                             'PA',
                             'VI',
                             'CO',
                             'DO',
                             'BE',
                             'JM',
                             'CA',
                             'MF',
                             'PT',
                             'RU',
                             'JP',
                             'SB',
                             'VN',
                             'ID',
                             'MO',
                             'BN',
                             'PG',
                             'KH',
                             'OM',
                             'SA',
                             'BH',
                             'IQ',
                             'SN',
                             'EG',
                             'LR',
                             'CI',
                             'GM',
                             'MR',
                             'TG',
                             'MA',
                             'FR',
                             'MX',
                             'ZA',
                             'ES',
                             'SE',
                             'TT',
                             'BJ',
                             'BR',
                             'CV',
                             'GH',
                             'GI',
                             'GN',
                             'GQ',
                             'IT',
                             'NG',
                             'DJ',
                             'ER',
                             'SX',
                             'GP',
                             'GY',
                             'SL',
                             'RE',
                             'GA',
                             'LK',
                             'AO',
                             'CG',
                             'CM',
                             'OT',
                             'TN',
                             'MT',
                             'TR',
                             'GR',
                             'SI',
                             'LB',
                             'RO',
                             'SR',
                             'VE',
                             'VC',
                             'AG',
                             'BB',
                             'GD',
                             'LC',
                             'TZ',
                             'YT',
                             'SO',
                             'KE',
                             'MZ',
                             'SC',
                             'GT',
                             'BS',
                             'BM',
                             'SD',
                             'EC',
                             'PR',
                             'UY',
                             'NC',
                             'CW',
                             'AW',
                             'CR',
                             'CU',
                             'HN',
                             'IL',
                             'SY',
                             'DK',
                             'EE',
                             'FI',
                             'LV',
                             'LT',
                             'PL',
                             'FO',
                             'IS',
                             'CY',
                             'HT',
                             'PE',
                             'CL',
                             'LY',
                             'DZ',
                             'MQ',
                             'JO',
                             'OTH',
                             'MU',
                             'CD',
                             'BD',
                             'SV',
                             'HR',
                             'AL',
                             'MP',
                             'KN',
                             'IE',
                             'TL',
                             'ME',
                             'KY',
                             'AR',
                             'GU',
                             'PW',
                             'FM',
                             'AS',
                             'FJ',
                             'NI',
                             'GE',
                             'MD',
                             'BG',
                             'UA',
                             'MM',
                             'MH',
                             'MV',
                             'PM',
                             'PY',
                             'GF',
                             'BZ',
                             'VG',
                             'DM',
                             'VU'])
  sch_scac = tf.feature_column.categorical_column_with_vocabulary_list(
      'sch_scac', ['others',
                 'ONEY',
                 'PABV',
                 'SUDU',
                 'OOLU',
                 'CMDU',
                 'ANNU',
                 'SEJJ',
                 'MAEU',
                 'CHNL',
                 'HLCU',
                 'COSU',
                 'APLU',
                 'SAFM',
                 'MCCQ',
                 'HDMU',
                 'WHLC',
                 'EGLV',
                 'YMLU',
                 'YMLX',
                 'SMLM',
                 'MSCU',
                 'KKCL',
                 'GOSU',
                 'ZIMU',
                 'CPRC',
                 'SEAU',
                 'NYKS',
                 'ANRM',
                 'UFEE',
                 'IILU',
                 'KKLU'])
  dest_lat = tf.feature_column.categorical_column_with_vocabulary_list(
      'dest_lat', ['-17.551624999999998',
                     '-21.139340999999998',
                     '-21.229236999999998',
                     '-36.848459',
                     '35.179553999999996',
                     '33.77005',
                     '-13.850695',
                     '-37.814107',
                     '61.768522999999995',
                     '53.539584',
                     '53.551083999999996',
                     '59.744074',
                     '51.92442',
                     '60.391262',
                     '53.567471',
                     '60.403057',
                     '59.283705999999995',
                     '53.327237',
                     '59.339382',
                     '58.451420999999996',
                     '61.599487999999994',
                     '60.201187',
                     '62.366665999999995',
                     '59.858861999999995',
                     '59.650717',
                     '-43.603258',
                     '-39.492844',
                     '-41.270632',
                     '-45.815897',
                     '-37.687798',
                     '24.806',
                     '24.990925999999998',
                     '22.83952',
                     '18.949824',
                     '27.103779',
                     '29.375859',
                     '24.861462',
                     '24.769693999999998',
                     '1.2800939999999998',
                     '13.104054999999999',
                     '25.204849',
                     '24.985713999999998',
                     '25.336565999999998',
                     '25.370725999999998',
                     '3.0050779999999997',
                     '29.034413999999998',
                     '25.03335',
                     '-18.144281',
                     '13.756464999999999',
                     '22.396428',
                     '31.321171999999997',
                     '10.315699',
                     '34.940695999999996',
                     '22.627278',
                     '14.599511999999999',
                     '14.616111',
                     '14.575833',
                     '22.556499',
                     '34.745562',
                     '35.999553999999996',
                     '22.483182',
                     '31.653015999999997',
                     '24.479834',
                     '24.411026',
                     '40.230636',
                     '21.941153999999997',
                     '37.476364',
                     '25.424051',
                     '41.119997',
                     '9.350598999999999',
                     '40.735656999999996',
                     '18.335361',
                     '10.391048999999999',
                     '18.425741',
                     '18.426097',
                     '51.35265',
                     '31.149953',
                     '18.042327',
                     '19.697551',
                     '9.335286',
                     '44.648863',
                     '30.332183999999998',
                     '45.273315',
                     '17.690808',
                     '18.064911',
                     '29.749167',
                     '38.534844',
                     '37.742242',
                     '38.683333',
                     '38.722252',
                     '46.635379',
                     '42.737739',
                     '31.968037',
                     '42.822275',
                     '59.563525999999996',
                     '34.385203',
                     '53.04091',
                     '35.077354',
                     '38.267869',
                     '35.443708',
                     '35.375974',
                     '39.720008',
                     '23.156046',
                     '23.302847',
                     '-9.435092',
                     '21.47861',
                     '22.805239999999998',
                     '38.977426',
                     '22.547286',
                     '21.166458',
                     '23.047192',
                     '22.567622',
                     '25.15958',
                     '22.148616999999998',
                     '10.505282',
                     '-6.101298',
                     '-7.257472',
                     '30.620186999999998',
                     '34.690083',
                     '35.03873',
                     '34.693737999999996',
                     '35.61',
                     '22.207659',
                     '5.980408',
                     '1.470288',
                     '1.363721',
                     '5.03332',
                     '25.127603',
                     '13.663312999999999',
                     '10.770826999999999',
                     '16.054406999999998',
                     '20.844912',
                     '23.085594',
                     '-7.1652439999999995',
                     '8.521654999999999',
                     '-6.7155249999999995',
                     '21.73076',
                     '10.625302',
                     '22.86204',
                     '23.021479',
                     '22.872142',
                     '40.800734999999996',
                     '22.900181999999997',
                     '22.967046999999997',
                     '22.736765',
                     '22.645384',
                     '29.883518',
                     '24.513507999999998',
                     '27.024744',
                     '27.478761',
                     '9.954634',
                     '18.938631',
                     '26.182823',
                     '30.034167',
                     '14.673150999999999',
                     '31.265289',
                     '6.290743',
                     '4.757868',
                     '13.454875999999999',
                     '17.99005',
                     '6.172496',
                     '35.891206',
                     '51.021367999999995',
                     '53.359401999999996',
                     '19.173773',
                     '-29.880726',
                     '36.140758999999996',
                     '28.123545999999997',
                     '39.469908',
                     '42.240598999999996',
                     '5.3254209999999995',
                     '58.016667',
                     '10.666667',
                     '6.370292',
                     '-20.297618',
                     '16.876545',
                     '14.93305',
                     '50.816666999999995',
                     '4.901579',
                     '5.7089229999999995',
                     '36.140772999999996',
                     '9.511567999999999',
                     '1.8533169999999999',
                     '44.25606',
                     '33.57311',
                     '6.431048',
                     '22.528515',
                     '11.593852',
                     '15.609167',
                     '10.405699',
                     '18.029583',
                     '9.142275999999999',
                     '16.237686',
                     '6.801279',
                     '8.465676',
                     '-20.930377999999997',
                     '4.815554',
                     '0.337956',
                     '6.927078',
                     '-8.838333',
                     '-4.769162',
                     '4.051056',
                     '3.7504109999999997',
                     '2.937618',
                     '-22.956111',
                     '36.81268',
                     '39.223841',
                     '38.426226',
                     '44.10245',
                     '35.841667',
                     '41.385062999999995',
                     '44.417138',
                     '39.679863',
                     '43.296482',
                     '40.882994',
                     '40.431819999999995',
                     '40.751483',
                     '40.978092',
                     '38.760117',
                     '41.004297',
                     '40.640063',
                     '40.682441',
                     '46.803283',
                     '38.423733999999996',
                     '36.812104',
                     '40.353707',
                     '40.976774',
                     '40.763805',
                     '36.671372999999996',
                     '35.889387',
                     '40.802516',
                     '30.510582999999997',
                     '40.775406',
                     '37.942986',
                     '45.649525999999994',
                     '45.440847',
                     '45.548058999999995',
                     '51.961726',
                     '45.805046999999995',
                     '42.352244',
                     '37.957156',
                     '44.418358999999995',
                     '33.888629',
                     '44.173333',
                     '5.852035',
                     '10.234368',
                     '10.633333',
                     '13.15',
                     '17.127409999999998',
                     '9.364936',
                     '13.113221999999999',
                     '12.056097',
                     '37.250068',
                     '14.010275',
                     '-6.165916999999999',
                     '-12.734722',
                     '2.046934',
                     '5.414921',
                     '21.543333',
                     '-4.043477',
                     '-19.796381',
                     '-25.966666999999998',
                     '-14.542778',
                     '-4.616667',
                     '-6.836837',
                     '-33.9697',
                     '-34.76779',
                     '-41.115415',
                     '-12.462826999999999',
                     '57.79',
                     '47.252877',
                     '53.8898',
                     '28.954136',
                     '15.69018',
                     '25.761678999999997',
                     '29.951065999999997',
                     '26.528471999999997',
                     '53.53234',
                     '51.504200000000004',
                     '51.318946',
                     '45.501689',
                     '39.290385',
                     '42.360082999999996',
                     '32.776475',
                     '40.712784',
                     '36.850769',
                     '39.952584',
                     '32.083541',
                     '39.729558',
                     '32.294816',
                     '20.960718',
                     '11.240355',
                     '37.513068',
                     '37.582487',
                     '36.96635',
                     '39.630866999999995',
                     '39.27307',
                     '36.88091',
                     '38.371383',
                     '31.331462',
                     '19.616667',
                     '39.935385',
                     '39.010858',
                     '20.044002',
                     '24.874132',
                     '-2.170998',
                     '33.775921',
                     '34.811834999999995',
                     '34.147783',
                     '49.286',
                     '21.306943999999998',
                     '33.736062',
                     '37.935758',
                     '35.448823',
                     '17.956765',
                     '18.466334',
                     '29.990288999999997',
                     '28.08213',
                     '-33.958718',
                     '-34.901112999999995',
                     '-41.178353',
                     '-46.599612',
                     '-39.055625',
                     '-44.396972',
                     '-32.056039999999996',
                     '-34.480074',
                     '-27.37595',
                     '-41.052465',
                     '-38.352900000000005',
                     '34.006831999999996',
                     '34.769199',
                     '33.591358',
                     '34.50401',
                     '30.753923999999998',
                     '36.706773999999996',
                     '24.263966',
                     '33.745753',
                     '35.281341',
                     '25.204721',
                     '25.454085',
                     '23.987159',
                     '24.881738',
                     '25.962984',
                     '35.416329',
                     '35.97556',
                     '38.052420999999995',
                     '36.100226',
                     '-41.28646',
                     '-32.926688999999996',
                     '-22.255823',
                     '34.485898999999996',
                     '34.166562',
                     '33.839157',
                     '34.510791999999995',
                     '34.035404',
                     '33.9375',
                     '34.052589999999995',
                     '33.250692',
                     '35.083332999999996',
                     '13.778932999999999',
                     '32.148872',
                     '37.804364',
                     '35.607267',
                     '33.941137999999995',
                     '35.015888',
                     '34.965157',
                     '24.594229',
                     '35.530906',
                     '10.818463',
                     '34.637986999999995',
                     '12.114196999999999',
                     '12.114827',
                     '26.093711',
                     '12.482585',
                     '11.004107',
                     '9.99131',
                     '22.993610999999998',
                     '-23.967882',
                     '22.407746',
                     '-8.39316',
                     '10.587508',
                     '10.466667',
                     '-3.1190279999999997',
                     '9.992424999999999',
                     '20.01693',
                     '21.281191',
                     '29.691063',
                     '15.825071999999999',
                     '36.836287',
                     '31.140579',
                     '31.804381',
                     '32.794046',
                     '35.54071',
                     '31.134224',
                     '41.118882',
                     '55.676097',
                     '55.568929',
                     '57.107118',
                     '59.490798999999996',
                     '59.674586999999995',
                     '60.173323999999994',
                     '55.686429',
                     '54.323293',
                     '57.04945',
                     '56.949649',
                     '55.703295',
                     '59.220537',
                     '54.518888999999994',
                     '59.934279999999994',
                     '57.690709999999996',
                     '56.046467',
                     '54.604',
                     '55.470138999999996',
                     '59.910700000000006',
                     '53.428543999999995',
                     '62.007864',
                     '64.133333',
                     '56.162938999999994',
                     '54.352025',
                     '56.674374',
                     '55.604980999999995',
                     '34.70713',
                     '31.417538999999998',
                     '36.584672999999995',
                     '49.494369999999996',
                     '26.512131999999998',
                     '30.439200999999997',
                     '61.130841999999994',
                     '59.913869',
                     '58.587745',
                     '59.329324',
                     '31.924557',
                     '18.594395',
                     '26.705620999999997',
                     '27.950574999999997',
                     '-17.668083',
                     '8.956825',
                     '3.883047',
                     '8.961395999999999',
                     '-12.050849',
                     '-17.005405',
                     '-5.093849',
                     '-3.257071',
                     '-18.478253',
                     '-33.592281',
                     '19.113809',
                     '9.940055',
                     '43.359305',
                     '43.437881999999995',
                     '38.193813999999996',
                     '40.756189',
                     '32.367635',
                     '43.615829',
                     '32.887209',
                     '36.766667',
                     '-12.97304',
                     '41.189018',
                     '50.9097',
                     '37.150475',
                     '38.526044',
                     '35.103341',
                     '35.697654',
                     '36.721261',
                     '42.391484999999996',
                     '28.489061',
                     '14.616064999999999',
                     '6.45528',
                     '32.116667',
                     '29.509909999999998',
                     '-26.185807999999998',
                     '29.531919',
                     '31.322222',
                     '34.438094',
                     '43.529303',
                     '40.46436',
                     '-20.166667',
                     '34.916667',
                     '16.950903',
                     '24.466666999999998',
                     '-0.881999',
                     '36.319969',
                     '24.522482999999998',
                     '60.569202999999995',
                     '37.625682999999995',
                     '60.466621999999994',
                     '60.674879',
                     '53.96',
                     '35.825603',
                     '53.408370999999995',
                     '42.092424',
                     '43.094269999999995',
                     '63.845155',
                     '65.316698',
                     '65.76388899999999',
                     '65.66566',
                     '29.685667',
                     '27.997062999999997',
                     '22.578737999999998',
                     '61.598212999999994',
                     '63.674243999999995',
                     '22.572646',
                     '13.08268',
                     '22.066674',
                     '13.295703',
                     '20.913021',
                     '8.764166',
                     '17.683142999999998',
                     '58.936181999999995',
                     '53.079296',
                     '59.434090999999995',
                     '55.126957',
                     '51.432514',
                     '53.614011999999995',
                     '51.46152',
                     '51.463024',
                     '49.485909',
                     '49.353319',
                     '43.532201',
                     '48.390394',
                     '47.327051999999995',
                     '-32.983333',
                     '-33.924869',
                     '-12.366667',
                     '-22.906847',
                     '43.462305',
                     '54.597285',
                     '46.160329',
                     '44.899834999999996',
                     '51.474216',
                     '19.737036',
                     '51.127874999999996',
                     '53.745670999999994',
                     '51.44011',
                     '9.297917',
                     '-5.839640999999999',
                     '34.07027',
                     '22.494218999999998',
                     '23.655707',
                     '62.472227999999994',
                     '54.710426',
                     '58.159910999999994',
                     '53.66576',
                     '61.935542999999996',
                     '53.859336',
                     '30.427754999999998',
                     '-37.034076999999996',
                     '-29.959000999999997',
                     '-33.047238',
                     '41.008238',
                     '55.476465999999995',
                     '51.701816',
                     '59.053836',
                     '59.055487',
                     '58.312174999999996',
                     '13.5957',
                     '30.226595',
                     '32.715738',
                     '30.080174',
                     '25.957221999999998',
                     '28.410349999999998',
                     '12.254370999999999',
                     '55.016667',
                     '12.509203999999999',
                     '-1.536142',
                     '-36.706069',
                     '0.968178',
                     '-0.967653',
                     '13.920556',
                     '-2.9760739999999997',
                     '13.654244',
                     '24.1049',
                     '25.405216',
                     '45.327062999999995',
                     '35.898908999999996',
                     '41.332806999999995',
                     '36.752887',
                     '36.871519',
                     '35.338735',
                     '41.117143',
                     '26.212311999999997',
                     '15.152049',
                     '18.694767',
                     '14.791058',
                     '39.046696',
                     '10.64785',
                     '23.04',
                     '21.481254',
                     '22.765435',
                     '23.404165',
                     '35.585575',
                     '21.68686',
                     '22.780362',
                     '14.288601',
                     '12.914142',
                     '15.387435',
                     '21.138735',
                     '31.352859',
                     '32.271163',
                     '32.187849',
                     '33.283744999999996',
                     '32.318822',
                     '33.979583',
                     '37.916191999999995',
                     '32.370557',
                     '30.543494',
                     '31.76633',
                     '36.790631',
                     '34.756949999999996',
                     '40.000786999999995',
                     '31.670451999999997',
                     '34.342788',
                     '31.980172',
                     '33.264586',
                     '36.561325',
                     '36.949087999999996',
                     '25.128809',
                     '17.302606',
                     '39.849557',
                     '59.995929999999994',
                     '51.896892',
                     '53.349804999999996',
                     '63.825846999999996',
                     '56.009715',
                     '44.29756',
                     '59.111459999999994',
                     '23.008141',
                     '-5.221884',
                     '-1.237927',
                     '-3.3186069999999996',
                     '3.784303',
                     '-5.464115',
                     '0.665805',
                     '-0.02633',
                     '-0.49482299999999996',
                     '-6.966666999999999',
                     '3.9702219999999997',
                     '-17.951221',
                     '-6.011873',
                     '-0.947083',
                     '-3.9094439999999997',
                     '1.171271',
                     '-5.147665',
                     '31.866743',
                     '47.606209',
                     '3.327359',
                     '-8.556854999999999',
                     '-8.807599',
                     '1.440374',
                     '7.308706',
                     '7.190708',
                     '-8.729721999999999',
                     '-3.6553929999999997',
                     '-0.8614529999999999',
                     '0.789886',
                     '-8.620842999999999',
                     '-0.708611',
                     '-10.198',
                     '15.414408',
                     '28.923384',
                     '52.259319',
                     '35.114911',
                     '37.720531',
                     '34.733333',
                     '42.089214',
                     '39.976247',
                     '36.729861',
                     '43.056311',
                     '37.507877',
                     '38.115688',
                     '36.824166999999996',
                     '44.035967',
                     '38.24664',
                     '65.012615',
                     '52.370214999999995',
                     '-5.779256999999999',
                     '47.302051999999996',
                     '30.614867999999998',
                     '54.315037',
                     '29.705078',
                     '31.994701',
                     '30.695366',
                     '10.895895999999999',
                     '11.669426999999999',
                     '30.158813',
                     '18.466666999999998',
                     '19.286932',
                     '25.047983',
                     '39.275818',
                     '42.611506999999996',
                     '42.984854',
                     '33.951509',
                     '34.237977',
                     '32.427517',
                     '31.495441999999997',
                     '36.019017999999996',
                     '35.965756',
                     '23.249415',
                     '34.230511',
                     '36.396615',
                     '33.957831',
                     '-19.257621999999998',
                     '31.582976',
                     '33.558803999999995',
                     '43.171383999999996',
                     '37.18586',
                     '-26.894792',
                     '-22.863191999999998',
                     '-22.931641',
                     '-34.603684',
                     '-33.97423',
                     '-34.095780999999995',
                     '-26.910595999999998',
                     '35.139184',
                     '24.34066',
                     '28.686700000000002',
                     '40.512284',
                     '40.639976999999995',
                     '-3.731862',
                     '47.978984999999994',
                     '41.768792999999995',
                     '38.914432999999995',
                     '13.460478',
                     '7.341062',
                     '9.539137',
                     '45.64129',
                     '14.70557',
                     '-3.5522449999999997',
                     '59.352875',
                     '49.385602',
                     '38.733916',
                     '32.739115',
                     '1.607681',
                     '5.839443999999999',
                     '4.244651',
                     '7.1756',
                     '3.171322',
                     '36.825874999999996',
                     '36.527060999999996',
                     '43.508131999999996',
                     '38.017618',
                     '-33.766667',
                     '-12.787749',
                     '-25.516572999999998',
                     '-32.035378',
                     '27.636547',
                     '-32.944243',
                     '-28.228870999999998',
                     '13.214594',
                     '-12.323134999999999',
                     '-20.230703',
                     '62.390811',
                     '62.951026',
                     '37.389092',
                     '51.934731',
                     '51.851271',
                     '-14.279444',
                     '-18.124807999999998',
                     '-35.843118',
                     '-17.624167',
                     '7.1958839999999995',
                     '62.675449',
                     '67.16009799999999',
                     '64.86207499999999',
                     '63.110333999999995',
                     '63.312231999999995',
                     '68.56454',
                     '66.313712',
                     '68.69588399999999',
                     '61.220064',
                     '69.649204',
                     '70.634501',
                     '70.663438',
                     '68.913333',
                     '-26.258414',
                     '18.474470999999998',
                     '10.434794',
                     '19.639481',
                     '12.490741',
                     '51.830428',
                     '5.283145',
                     '6.116385999999999',
                     '-23.068395',
                     '35.184148',
                     '-23.650928',
                     '-36.72615',
                     '53.897940999999996',
                     '40.152139',
                     '42.595351',
                     '39.5696',
                     '41.638611',
                     '45.481666999999995',
                     '43.190343',
                     '46.482526',
                     '45.156743999999996',
                     '41.279908999999996',
                     '46.975032999999996',
                     '44.715401',
                     '58.3498',
                     '42.484884',
                     '29.648891',
                     '16.889359',
                     '11.603981',
                     '10.822737',
                     '1.1110309999999999',
                     '22.347535999999998',
                     '20.956474999999998',
                     '-5.934933',
                     '16.780832999999998',
                     '-23.832466',
                     '-0.7351019999999999',
                     '1.171111',
                     '-28.780728',
                     '-23.351619',
                     '33.030262',
                     '7.0859309999999995',
                     '36.939581',
                     '36.013123',
                     '35.292277999999996',
                     '20.942518',
                     '36.834047',
                     '38.041275',
                     '28.969946',
                     '38.345996',
                     '43.489646',
                     '16.183349',
                     '28.500821',
                     '28.683989',
                     '43.407875999999995',
                     '4.175495',
                     '43.647279',
                     '47.560541',
                     '46.775846',
                     '61.633317',
                     '55.925039',
                     '59.195363',
                     '46.980925',
                     '46.301666999999995',
                     '25.98049',
                     '25.513233999999997',
                     '25.978859999999997',
                     '-25.562811999999997',
                     '-34.226635',
                     '-34.163335',
                     '-38.718318',
                     '-54.801911999999994',
                     '27.145339999999997',
                     '25.291943999999997',
                     '55.956475999999995',
                     '51.912065999999996',
                     '57.149716999999995',
                     '34.210389',
                     '29.301347999999997',
                     '4.8546000000000005',
                     '37.029868',
                     '19.780769',
                     '-42.769448',
                     '-53.163833',
                     '34.722939',
                     '30.367418999999998',
                     '17.504566',
                     '20.848249',
                     '-38.005477',
                     '-26.358836999999998',
                     '61.218056',
                     '-25.166667',
                     '23.09',
                     '20.316551999999998',
                     '8.454236',
                     '10.72015',
                     '6.921442',
                     '9.30684',
                     '53.331027',
                     '43.190717',
                     '42.518487',
                     '18.422995',
                     '15.301388999999999',
                     '17.896435',
                     '-33.859412',
                     '58.670173999999996',
                     '22.695753999999997',
                     '-26.645833',
                     '37.6606',
                     '51.813297999999996',
                     '41.002697',
                     '41.279703',
                     '59.460496',
                     '29.837563',
                     '19.698332999999998',
                     '27.918333',
                     '16.166667',
                     '13.43262',
                     '46.624021',
                     '42.141943999999995',
                     '-15.195278',
                     '-6.1333329999999995',
                     '-5.816667',
                     '23.081667',
                     '13.160024',
                     '-9.443800000000001',
                     '16.017326999999998',
                     '53.865466999999995',
                     '54.100294999999996',
                     '10.663720999999999',
                     '4.723815',
                     '65.757222',
                     '63.437678999999996',
                     '58.611025999999995',
                     '64.357222',
                     '21.857958',
                     '35.645244',
                     '-17.733251',
                     '-15.51573',
                     '5.5544'])
  dest_lon = tf.feature_column.categorical_column_with_vocabulary_list(
      'dest_lon', ['-149.55847',
                     '-175.20494',
                     '-159.77634899999998',
                     '174.763331',
                     '129.075642',
                     '-118.19373',
                     '-171.75135',
                     '144.96328',
                     '5.295509',
                     '8.580942',
                     '9.993680999999999',
                     '10.204456',
                     '4.1403859999999995',
                     '5.322054',
                     '-0.080784',
                     '5.019266',
                     '5.3068729999999995',
                     '8.477544',
                     '5.290471999999999',
                     '5.999803',
                     '5.03144',
                     '5.62272',
                     '6.033333',
                     '5.747472',
                     '6.354143',
                     '172.719323',
                     '176.912018',
                     '173.283965',
                     '170.62135',
                     '176.16512999999998',
                     '54.651',
                     '51.549347999999995',
                     '69.72132599999999',
                     '72.949991',
                     '56.070136999999995',
                     '47.977405',
                     '67.009939',
                     '67.334688',
                     '103.85094',
                     '100.915807',
                     '55.270782999999994',
                     '55.02729',
                     '56.343261999999996',
                     '55.38176',
                     '101.4086',
                     '48.096562999999996',
                     '51.593685',
                     '49.395782999999994',
                     '121.058308',
                     '114.109497',
                     '121.655358',
                     '123.885437',
                     '127.695888',
                     '120.301435',
                     '120.98422',
                     '120.956667',
                     '120.969167',
                     '114.236875',
                     '119.42203',
                     '120.19677',
                     '113.916509',
                     '121.209412',
                     '118.089425',
                     '118.05978999999999',
                     '122.10781399999999',
                     '113.22827',
                     '126.616936',
                     '119.289894',
                     '122.070714',
                     '-79.901527',
                     '-74.172367',
                     '-64.953401',
                     '-75.479426',
                     '-69.630833',
                     '-70.01735',
                     '4.256473',
                     '-81.491489',
                     '-76.802893',
                     '-71.74148799999999',
                     '-79.941654',
                     '-63.57532',
                     '-81.65565099999999',
                     '-66.06330799999999',
                     '-64.74931099999999',
                     '-63.088905999999994',
                     '-95.110833',
                     '-28.629980999999997',
                     '-25.67495',
                     '-28.216666999999998',
                     '-9.139337',
                     '142.78418',
                     '133.085354',
                     '120.415649',
                     '132.88340399999998',
                     '150.7289',
                     '132.45529299999998',
                     '158.677725',
                     '128.78262',
                     '141.02498500000002',
                     '139.638026',
                     '139.91683',
                     '140.102564',
                     '112.896607',
                     '116.772994',
                     '159.951239',
                     '111.07273',
                     '113.29335',
                     '117.74374',
                     '113.86883399999999',
                     '110.404434',
                     '112.465091',
                     '113.477988',
                     '121.39468',
                     '113.444824',
                     '107.005745',
                     '106.89045',
                     '112.752088',
                     '122.058106',
                     '135.195511',
                     '136.83589',
                     '135.502165',
                     '139.78',
                     '113.549951',
                     '116.07345',
                     '103.90296',
                     '103.55208',
                     '115.073288',
                     '121.739183',
                     '100.58211',
                     '106.785392',
                     '108.202167',
                     '106.688084',
                     '113.40645599999999',
                     '112.651988',
                     '124.74820000000001',
                     '146.999905',
                     '108.58268699999999',
                     '103.523396',
                     '113.57327',
                     '113.121436',
                     '113.572111',
                     '121.059746',
                     '112.892578',
                     '113.502205',
                     '113.27205000000001',
                     '113.675322',
                     '121.968842',
                     '56.611774',
                     '49.679232',
                     '52.627959999999995',
                     '76.267825',
                     '72.84102899999999',
                     '50.714016',
                     '47.929444',
                     '-17.422342',
                     '32.301866',
                     '-10.760523',
                     '-6.642433',
                     '-16.579031999999998',
                     '-16.035854999999998',
                     '1.231361',
                     '-5.494752',
                     '2.1979949999999997',
                     '7.206009',
                     '-96.13422399999999',
                     '31.049571999999998',
                     '-5.456233',
                     '-15.436257',
                     '-0.37628799999999996',
                     '-8.720727',
                     '-4.020411',
                     '11.700000000000001',
                     '-61.516667',
                     '2.3912359999999997',
                     '-40.295777',
                     '-24.981348999999998',
                     '-23.513326',
                     '-1.0833329999999999',
                     '-1.783097',
                     '0.018654999999999998',
                     '-5.353599',
                     '-13.722076999999999',
                     '9.779022',
                     '8.391012',
                     '-7.589842999999999',
                     '3.3435509999999997',
                     '39.092062999999996',
                     '43.10565',
                     '39.445277999999995',
                     '-61.463065',
                     '-63.047137',
                     '-79.724052',
                     '-61.534042',
                     '-58.155125',
                     '-13.231722',
                     '55.315346',
                     '7.049843999999999',
                     '9.483281999999999',
                     '79.861243',
                     '13.234444',
                     '11.866361999999999',
                     '9.767868',
                     '8.737103',
                     '9.90559',
                     '14.508056',
                     '10.296313999999999',
                     '9.121661',
                     '15.898867',
                     '9.824081999999999',
                     '14.544722',
                     '2.173403',
                     '8.794899',
                     '-0.27843799999999996',
                     '5.3697799999999996',
                     '14.286579',
                     '29.155416',
                     '29.836828999999998',
                     '27.511674',
                     '26.927265',
                     '29.013133',
                     '22.944419',
                     '14.768096',
                     '-71.242796',
                     '27.142826',
                     '34.641481',
                     '27.971404999999997',
                     '28.711053',
                     '29.747500000000002',
                     '36.217635',
                     '-5.321345',
                     '29.439794',
                     '32.445309',
                     '29.713175',
                     '23.646983',
                     '13.776817999999999',
                     '12.315515',
                     '13.730188',
                     '1.3512549999999999',
                     '13.533173',
                     '14.402811',
                     '-8.860890999999999',
                     '12.203529',
                     '35.495478999999996',
                     '28.638333',
                     '-55.203827',
                     '-64.591805',
                     '-71.633333',
                     '-61.226667',
                     '-61.846771999999994',
                     '-79.886505',
                     '-59.598808999999996',
                     '-61.748799',
                     '15.221696999999999',
                     '-60.992703',
                     '39.202641',
                     '45.163333',
                     '45.318162',
                     '100.32976',
                     '39.172778',
                     '39.668206999999995',
                     '34.884485999999995',
                     '32.583332999999996',
                     '40.672778',
                     '55.483332999999995',
                     '39.295167',
                     '151.20992999999999',
                     '138.4915',
                     '146.863556',
                     '130.841777',
                     '-152.40722',
                     '-122.44429',
                     '-166.5422',
                     '-95.359661',
                     '-88.620407',
                     '-80.19179',
                     '-90.07153199999999',
                     '-78.69658299999999',
                     '8.106872',
                     '0.502582',
                     '3.2068499999999998',
                     '-73.567256',
                     '-76.612189',
                     '-71.05888',
                     '-79.931051',
                     '-74.00594099999999',
                     '-76.285873',
                     '-75.165222',
                     '-81.099834',
                     '-75.467973',
                     '-64.781375',
                     '-97.337837',
                     '-74.211023',
                     '122.12042',
                     '121.37861699999999',
                     '126.836105',
                     '118.180194',
                     '118.46037',
                     '122.444115',
                     '117.330048',
                     '121.552423',
                     '37.216667',
                     '119.600493',
                     '121.874892',
                     '110.198293',
                     '118.675676',
                     '-79.922359',
                     '130.98051',
                     '126.392166',
                     '-119.19510000000001',
                     '-123.09200000000001',
                     '-157.85833',
                     '-118.29223999999999',
                     '-122.34774',
                     '129.359765',
                     '-102.19434',
                     '-66.105722',
                     '121.838014',
                     '121.151138',
                     '25.639319',
                     '-56.164531',
                     '146.360953',
                     '168.345709',
                     '174.07522799999998',
                     '171.254973',
                     '115.74718',
                     '150.900495',
                     '153.171515',
                     '145.906851',
                     '141.6098',
                     '131.559326',
                     '137.39146',
                     '130.414878',
                     '133.673744',
                     '120.758543',
                     '119.16175',
                     '120.51088',
                     '-118.25717',
                     '139.6722',
                     '118.977776',
                     '119.007777',
                     '121.601571',
                     '118.683444',
                     '119.382935',
                     '119.526885',
                     '126.56103999999999',
                     '-122.21302',
                     '120.326256',
                     '174.77623599999998',
                     '151.778921',
                     '166.45051999999998',
                     '133.362313',
                     '132.218848',
                     '132.765575',
                     '135.453948',
                     '131.78613',
                     '130.771389',
                     '133.03024',
                     '131.738944',
                     '119.333333',
                     '109.247338',
                     '118.91463999999999',
                     '-122.27111',
                     '140.106291',
                     '130.959663',
                     '138.489528',
                     '136.624485',
                     '121.853326',
                     '139.703051',
                     '106.658825',
                     '138.128127',
                     '-68.93038899999999',
                     '-68.91444',
                     '-80.124664',
                     '-69.981832',
                     '-74.806981',
                     '-83.041507',
                     '-82.753889',
                     '-46.328886999999995',
                     '-97.921156',
                     '-34.964195',
                     '-66.921362',
                     '-68.016667',
                     '-60.021730999999996',
                     '-83.095185',
                     '-75.830153',
                     '-89.66516299999999',
                     '-95.2091',
                     '-87.928578',
                     '30.611235999999998',
                     '29.786510999999997',
                     '34.655314',
                     '34.989571',
                     '35.795266',
                     '29.801617',
                     '1.2444899999999999',
                     '12.568337',
                     '9.749516999999999',
                     '12.252091',
                     '24.9386',
                     '28.405302',
                     '25.187670999999998',
                     '11.089188',
                     '10.122765',
                     '10.055537',
                     '24.105186',
                     '21.144278999999997',
                     '10.934700999999999',
                     '18.53054',
                     '30.335098',
                     '11.845932',
                     '12.694512',
                     '-1.1580000000000001',
                     '10.537056999999999',
                     '29.735961',
                     '14.552812',
                     '-6.790982',
                     '-21.933332999999998',
                     '10.203921',
                     '18.646638',
                     '12.857788',
                     '13.003822',
                     '33.022617',
                     '31.814442999999997',
                     '36.175616',
                     '0.107929',
                     '50.198336',
                     '49.070778',
                     '21.505959',
                     '10.752245',
                     '16.192421',
                     '18.068581',
                     '120.172749',
                     '-72.30743199999999',
                     '-80.03643',
                     '-82.457178',
                     '-71.346809',
                     '-79.57998099999999',
                     '-77.01972099999999',
                     '-79.563153',
                     '-77.125984',
                     '-72.100143',
                     '-81.096217',
                     '-80.00164',
                     '-70.31259899999999',
                     '-71.60551199999999',
                     '-104.33846',
                     '-84.727638',
                     '-3.067596',
                     '4.945711',
                     '15.554015',
                     '29.830917999999997',
                     '15.219265',
                     '13.518915',
                     '13.191338',
                     '10.283332999999999',
                     '-38.502303999999995',
                     '-8.680818',
                     '-1.40435',
                     '-6.8797049999999995',
                     '-8.890933',
                     '-1.861656',
                     '-0.633738',
                     '-4.421266',
                     '-8.702081999999999',
                     '-16.222955',
                     '-61.05878',
                     '3.3640839999999996',
                     '20.066667',
                     '34.99615',
                     '-48.604416',
                     '35.006084',
                     '30.073611',
                     '35.830836999999995',
                     '10.372247999999999',
                     '17.24703',
                     '57.516667',
                     '33.633333',
                     '54.006972999999995',
                     '54.366667',
                     '131.295483',
                     '33.88792',
                     '54.387718',
                     '27.193845999999997',
                     '-0.9965839999999999',
                     '26.945999',
                     '17.141272',
                     '10.853575',
                     '10.608395',
                     '-2.991573',
                     '11.795413',
                     '131.87351999999998',
                     '23.017681',
                     '21.480036',
                     '24.162778',
                     '24.513484',
                     '-95.06676',
                     '120.87987',
                     '113.081901',
                     '21.468270999999998',
                     '22.712569',
                     '88.363895',
                     '80.270718',
                     '88.069812',
                     '80.338021',
                     '71.50898',
                     '78.13483599999999',
                     '83.23989399999999',
                     '5.574096',
                     '8.801693',
                     '10.658382999999999',
                     '-1.5102769999999999',
                     '0.675702',
                     '-0.215913',
                     '3.68896',
                     '0.360498',
                     '0.48789099999999996',
                     '0.9811000000000001',
                     '-5.661118999999999',
                     '-4.486076',
                     '-2.1504309999999998',
                     '27.866667',
                     '18.424055',
                     '13.533332999999999',
                     '-43.172897',
                     '-3.80998',
                     '-5.93012',
                     '-1.151139',
                     '-0.516238',
                     '-2.7211089999999998',
                     '-72.206768',
                     '1.313402',
                     '-0.33674099999999996',
                     '0.764158',
                     '-82.42110199999999',
                     '13.070264',
                     '134.55484',
                     '89.60161699999999',
                     '90.450679',
                     '6.149482',
                     '20.452213999999998',
                     '8.018206',
                     '-0.236764',
                     '5.113554',
                     '8.687904999999999',
                     '-9.598106999999999',
                     '-73.140484',
                     '-71.33891799999999',
                     '-71.612689',
                     '28.978358999999998',
                     '8.459405',
                     '4.627349',
                     '10.029546',
                     '9.698005',
                     '6.961761999999999',
                     '-89.827089',
                     '-93.217376',
                     '-117.16108',
                     '-94.126556',
                     '-97.385278',
                     '-80.618815',
                     '-71.95935',
                     '-1.4000000000000001',
                     '-70.00863',
                     '-48.752174',
                     '-72.97674099999999',
                     '-79.65172',
                     '-80.70891',
                     '-90.787778',
                     '104.775431',
                     '100.55872',
                     '52.724191',
                     '55.513642999999995',
                     '14.442176',
                     '14.514553',
                     '19.461607',
                     '3.042048',
                     '6.9101799999999995',
                     '25.144212',
                     '16.871872',
                     '127.679157',
                     '145.722071',
                     '-72.35331099999999',
                     '120.239734',
                     '117.77203',
                     '106.74486',
                     '113.52',
                     '109.119927',
                     '112.964283',
                     '113.220218',
                     '119.761775',
                     '108.35384',
                     '113.313524',
                     '80.124848',
                     '74.855957',
                     '73.815439',
                     '72.735608',
                     '118.432941',
                     '119.43848',
                     '119.67051000000001',
                     '120.810715',
                     '119.881717',
                     '133.541984',
                     '139.03641299999998',
                     '120.574946',
                     '117.063755',
                     '120.939119',
                     '137.057263',
                     '134.841178',
                     '124.354451',
                     '118.50676',
                     '134.046574',
                     '120.894291',
                     '129.880269',
                     '136.656205',
                     '140.905586',
                     '56.326484',
                     '-62.717692',
                     '-75.355746',
                     '29.765545',
                     '-8.486316',
                     '-6.2603089999999995',
                     '20.263035',
                     '-3.722769',
                     '8.464500000000001',
                     '9.648845999999999',
                     '70.187255',
                     '145.78563',
                     '116.852853',
                     '114.594378',
                     '98.694221',
                     '105.32189',
                     '101.59587',
                     '109.342504',
                     '117.143615',
                     '110.416667',
                     '103.42299',
                     '122.244327',
                     '105.987668',
                     '100.41718',
                     '102.291944',
                     '104.00078',
                     '119.432731',
                     '-116.59637000000001',
                     '-122.33207',
                     '117.578504',
                     '125.56031',
                     '115.206701',
                     '125.12165',
                     '125.68411',
                     '125.66371',
                     '116.073611',
                     '128.190772',
                     '134.062042',
                     '127.375379',
                     '122.207703',
                     '119.857778',
                     '123.528',
                     '108.703816',
                     '50.820313999999996',
                     '-7.1100699999999994',
                     '33.919245',
                     '24.046398999999997',
                     '10.766667',
                     '19.087308999999998',
                     '0.017661',
                     '14.849113',
                     '17.431024999999998',
                     '15.083029999999999',
                     '13.361267',
                     '5.89',
                     '10.043825',
                     '21.734574',
                     '25.471453',
                     '4.895167',
                     '-35.200916',
                     '-53.986824',
                     '114.43565',
                     '-130.32081',
                     '116.00193',
                     '119.97752',
                     '-88.039891',
                     '-64.06650499999999',
                     '-70.21670499999999',
                     '-85.660206',
                     '-77.91666699999999',
                     '-81.36743899999999',
                     '-77.355413',
                     '141.885677',
                     '141.78273000000002',
                     '144.38135599999998',
                     '131.246786',
                     '132.222475',
                     '131.669023',
                     '131.045336',
                     '129.343481',
                     '140.644813',
                     '-106.41114',
                     '135.170808',
                     '140.534676',
                     '130.941459',
                     '146.817879',
                     '131.40416299999998',
                     '133.531168',
                     '141.31552',
                     '138.25503',
                     '-48.655069',
                     '-43.777909',
                     '-43.838331',
                     '-58.381558999999996',
                     '-59.202554',
                     '-59.024229999999996',
                     '-48.670950999999995',
                     '138.691013',
                     '124.15558',
                     '121.45401',
                     '141.48839900000002',
                     '-74.1893',
                     '-38.526669999999996',
                     '-122.20206999999999',
                     '140.72881',
                     '139.836515',
                     '144.67155',
                     '134.47715',
                     '138.12589',
                     '-122.74900000000001',
                     '-92.4017',
                     '-38.831897999999995',
                     '24.055159999999997',
                     '1.020078',
                     '-27.064698',
                     '-16.738207',
                     '110.378543',
                     '118.11717',
                     '117.89117999999999',
                     '100.61434',
                     '113.04190000000001',
                     '7.820647999999999',
                     '-6.288596',
                     '16.440193999999998',
                     '12.537201999999999',
                     '25.666667',
                     '-38.485096',
                     '-48.522998',
                     '-52.10758',
                     '-82.547613',
                     '-60.650538999999995',
                     '-48.666366',
                     '80.320292',
                     '49.294283',
                     '-70.135669',
                     '17.306926999999998',
                     '7.762892',
                     '-5.984458999999999',
                     '1.260297',
                     '-8.317675999999999',
                     '-170.70055',
                     '178.45006999999998',
                     '174.486677',
                     '177.452778',
                     '125.641604',
                     '8.551533',
                     '15.199387',
                     '11.237337',
                     '7.728078999999999',
                     '9.853523',
                     '14.9145',
                     '14.141974999999999',
                     '15.405111',
                     '6.075743999999999',
                     '18.955323',
                     '29.717844999999997',
                     '23.681966',
                     '15.068332999999999',
                     '-48.634845',
                     '-77.46732899999999',
                     '45.01399',
                     '57.67791',
                     '-87.178433',
                     '-8.321947999999999',
                     '115.23082',
                     '125.17161',
                     '-70.386785',
                     '128.603532',
                     '-70.397502',
                     '-73.135071',
                     '11.451602',
                     '-8.857583',
                     '-8.765908',
                     '2.65016',
                     '41.637222',
                     '28.197222',
                     '27.646700000000003',
                     '30.723308999999997',
                     '29.659547999999997',
                     '31.42026',
                     '31.994583',
                     '37.761966',
                     '11.935649',
                     '27.452602',
                     '32.357512',
                     '42.570567',
                     '43.136702',
                     '106.75523',
                     '103.97241',
                     '91.812332',
                     '107.023554',
                     '106.006463',
                     '96.149722',
                     '151.260533',
                     '8.759131',
                     '104.004166',
                     '32.038286',
                     '43.685493',
                     '130.445985',
                     '171.364116',
                     '126.434323',
                     '0.14013799999999998',
                     '-2.938097',
                     '-17.036227',
                     '-2.463714',
                     '23.541812999999998',
                     '-13.529148',
                     '-0.49068599999999996',
                     '-8.219344999999999',
                     '-22.914817',
                     '-13.862836999999999',
                     '-17.764575',
                     '3.7008219999999996',
                     '73.50934699999999',
                     '-70.256957',
                     '-52.712832',
                     '-56.180636',
                     '21.41666',
                     '14.297995',
                     '17.625688999999998',
                     '-123.88933',
                     '30.656944',
                     '56.056324',
                     '55.569084',
                     '56.057804',
                     '-57.507991',
                     '-58.06111',
                     '-58.959264',
                     '-62.266348',
                     '-68.302951',
                     '56.203686',
                     '60.643055999999994',
                     '-4.771983',
                     '4.349436',
                     '-2.094278',
                     '-77.886811',
                     '-94.797696',
                     '-52.2745',
                     '-76.345221',
                     '-70.68710899999999',
                     '-65.031718',
                     '-70.917068',
                     '-76.72604299999999',
                     '-89.092815',
                     '-88.196213',
                     '-86.876106',
                     '-57.542611',
                     '-70.645408',
                     '-149.90027',
                     '-57.550000000000004',
                     '113.47',
                     '86.611362',
                     '124.63189',
                     '122.562106',
                     '122.079026',
                     '123.305446',
                     '6.92446',
                     '140.994662',
                     '3.106592',
                     '-64.614122',
                     '-61.388332999999996',
                     '-62.852200999999994',
                     '121.893248',
                     '17.103733',
                     '114.555988',
                     '15.153889',
                     '120.307953',
                     '4.690093',
                     '39.716763',
                     '36.336067',
                     '24.651346',
                     '-93.956696',
                     '109.147222',
                     '-110.89888',
                     '-95.2',
                     '-87.455443',
                     '31.100064999999997',
                     '41.676389',
                     '12.150832999999999',
                     '12.366667',
                     '13.483333',
                     '112.39992',
                     '-61.224815',
                     '147.18026',
                     '-85.95855399999999',
                     '10.686558999999999',
                     '-6.257465',
                     '-14.584439999999999',
                     '7.151618',
                     '-19.647778',
                     '-20.267321',
                     '-3.5526269999999998',
                     '-21.778056',
                     '111.982232',
                     '136.055441',
                     '168.327325',
                     '167.1887',
                     '5.793201'])

  # use _hash_bucket when sparse features are in string or integer format
  # A hash function takes as input a key, which is associated with a record and used to identify it to data storage and retrieval application.
  # The keys may be fixed length, like an integer, or variable length, like a name.
  # The output is a hash code used to index a hash table holding the data or records, or pointers to them.
  # Set hash_bucket_size to avoid collisions: https://stackoverflow.com/questions/45685301/principle-of-setting-hash-bucket-size-parameter
  # To show an example of hashing:
  # occupation = tf.feature_column.categorical_column_with_hash_bucket(
  #     'occupation', hash_bucket_size=_HASH_BUCKET_SIZE)

  # Transformations.
  # age_buckets = tf.feature_column.bucketized_column(
  #     age, boundaries=[18, 25, 30, 35, 40, 45, 50, 55, 60, 65])

  # Wide columns and deep columns.
  base_columns = [dest_lat,
                  dest_lon,
                  dest_country_code,
                  sch_scac,
                  ]

  # crossed_columns = [
  #     tf.feature_column.crossed_column(
  #         ['education', 'occupation'], hash_bucket_size=_HASH_BUCKET_SIZE),
  #     tf.feature_column.crossed_column(
  #         [age_buckets, 'education', 'occupation'],
  #         hash_bucket_size=_HASH_BUCKET_SIZE),
  # ]
  # Create cross fts for any catg column, except categorical_column_with_hash_bucket (since crossed_column hashes the input)
  # Keep uncrossed fts in model, indep ft help model to distinguish btwn samples where a collision occurred in crossed ft
  # wide_columns = base_columns + crossed_columns

  wide_columns = base_columns

  deep_columns = [
      speed,
      inv_speed,
      ais_rem_time,
      haversine_distance,
      coastal_rem_time,
      tf.feature_column.indicator_column(dest_lat),
      tf.feature_column.indicator_column(dest_lon),
      tf.feature_column.indicator_column(dest_country_code),
      tf.feature_column.indicator_column(sch_scac),
      # To show an example of embedding
      # tf.feature_column.embedding_column(occupation, dimension=8),
  ]

  return wide_columns, deep_columns


# data_dir = 'C:\\tmp\\a6_nowait_data'
# train_file = os.path.join(data_dir, TRAINING_FILE)
# eval_file = os.path.join(data_dir, EVAL_FILE)


def input_fn(data_file, num_epochs, shuffle, batch_size):
  """Generate an input function for the Estimator."""
  assert tf.io.gfile.exists(data_file), (
      '%s not found. Please make sure you have run tt_dataset.py and '
      'set the --data_dir argument to the correct path.' % data_file)

  def parse_csv(value):
    tf.compat.v1.logging.info('Parsing {}'.format(data_file))
    columns = tf.io.decode_csv(value, record_defaults=_CSV_COLUMN_DEFAULTS)
    features = dict(list(zip(_CSV_COLUMNS, columns)))
    labels = features.pop('y_actual')
    return features, labels

  # Extract lines from input files using the Dataset API.
  print('CSV to Tensor...')
  dataset = tf.data.TextLineDataset(data_file).skip(1)
  print('Finished CSV to Tensor.')

  if shuffle:
    dataset = dataset.shuffle(buffer_size=_NUM_EXAMPLES['train'])

  print('Map parse_csv...')
  dataset = dataset.map(parse_csv, num_parallel_calls=5)
  print('Finished map parse_csv.')

  # We call repeat after shuffling, rather than before, to prevent separate
  # epochs from blending together.
  dataset = dataset.repeat(num_epochs)
  dataset = dataset.batch(batch_size)
  # set of examples used in one iteration (that is, one gradient update) in training
  # mini-batch size usually 10-1000; fixed during training and inference.
  return dataset


# ######################################################################################
# # A utility method to create a tf.data dataset from a Pandas Dataframe

# def input_fn(data_file, num_epochs, shuffle, batch_size):
#   """Generate an input function for the Estimator.
#   data_file: a dataframe
#   """
#   assert tf.io.gfile.exists(data_file), (
#       '%s not found. Please make sure you have run tt_dataset.py and '
#       'set the --data_dir argument to the correct path.' % data_file)
#
#   # def parse_csv(value):
#   #   tf.compat.v1.logging.info('Parsing {}'.format(data_file))
#   #   columns = tf.io.decode_csv(value, record_defaults=_CSV_COLUMN_DEFAULTS)
#   #   features = dict(list(zip(_CSV_COLUMNS, columns)))
#   #   labels = features.pop('y_actual')
#   #   return features, labels
#
#   # Extract lines from input files using the Dataset API.
#   # dataset = tf.data.TextLineDataset(data_file)
#
#   the_target = data_file.pop('y_actual')
#   dataset = tf.data.Dataset.from_tensor_slices((dict(data_file), the_target))
#
#   if shuffle:
#     dataset = dataset.shuffle(buffer_size=_NUM_EXAMPLES['train'])
#
#   # dataset = dataset.map(parse_csv, num_parallel_calls=5)
#
#   # We call repeat after shuffling, rather than before, to prevent separate
#   # epochs from blending together.
#   dataset = dataset.repeat(num_epochs)
#   dataset = dataset.batch(batch_size)
#   # set of examples used in one iteration (that is, one gradient update) in training
#   # mini-batch size usually 10-1000; fixed during training and inference.
#   return dataset


def define_data_download_flags():
  """Add flags specifying data download arguments."""
  flags.DEFINE_string(
      name="data_dir", default="D:\\tmp\\a6_nowait_data",
      help=flags_core.help_wrap(
          "Directory to download and extract data."))


def main(_):
  download(flags.FLAGS.data_dir)


if __name__ == '__main__':
  tf.compat.v1.logging.set_verbosity(tf.compat.v1.logging.INFO)
  define_data_download_flags()
  absl_app.run(main)
